# 攀岩路线可视化工具 (Climbing Route Visualizer)

这个工具用于在攀岩墙照片上可视化攀爬路线，标记攀爬点并显示攀爬顺序。现在还包含自动岩点检测功能！

## 功能

- 上传攀岩墙照片
- **自动检测照片中的岩点位置和坐标**
- 定义攀爬路线（岩点坐标）
- 自动在照片上标记岩点位置
- 用数字标注攀爬顺序
- 用箭头指示攀爬路径

## 使用方法

### 1. 添加新照片

将攀岩墙的照片放入 `images` 目录中。

### 2. 自动检测岩点

有两种方式使用自动岩点检测功能：

#### 方式1：手动触发

1. 在GitHub仓库页面，点击"Actions"标签
2. 选择"Visualize Climbing Routes"工作流
3. 点击"Run workflow"
4. 输入图片路径
5. 将"是否自动检测岩点"设置为"true"
6. 点击"Run workflow"开始执行

#### 方式2：推送新图片

当您推送新图片到 `images` 目录时，自动检测功能会自动运行，并生成岩点坐标文件。

### 3. 创建自定义路线配置

您可以手动创建路线配置，或者修改自动检测生成的配置。在 `routes` 目录中创建一个JSON配置文件，定义路线信息，包括每个岩点的坐标。例如：

```json
{
  "route_name": "我的攀爬路线",
  "difficulty": "V5",
  "description": "一条有挑战性的路线",
  "author": "您的名字",
  "date_created": "2025-08-17",
  "holds": [
    {"x": 450, "y": 820, "description": "起始点，红色大抓点"},
    {"x": 380, "y": 750, "description": "左手小抓点"},
    {"x": 520, "y": 680, "description": "右手抓点"}
    // ... 更多岩点
  ]
}
```

坐标系是以图片的左上角为原点(0,0)，向右为x轴正方向，向下为y轴正方向。

### 4. 运行可视化

有两种方式可以运行可视化：

#### 方式1：手动触发GitHub Actions工作流

1. 在GitHub仓库页面，点击"Actions"标签
2. 选择"Visualize Climbing Routes"工作流
3. 点击"Run workflow"
4. 输入图片路径和配置文件路径
5. 点击"Run workflow"开始执行

#### 方式2：推送更改到仓库

当您推送对`images`或`routes`目录中文件的更改时，工作流将自动运行。

### 5. 查看结果

生成的路线可视化图片将被保存到`images/output`目录中，并作为Actions运行的工件(artifacts)提供下载。自动检测的岩点坐标将保存在`detections`目录中。

## 自动岩点检测说明

自动岩点检测功能使用计算机视觉技术来识别攀岩墙上的岩点。它通过以下步骤工作：

1. 颜色分割：识别不同颜色的岩点
2. 边缘检测：找出岩点的轮廓
3. 形状分析：计算每个岩点的中心位置
4. 生成坐标：输出所有检测到的岩点坐标

请注意，自动检测的准确性取决于照片的质量、光线条件和岩点与背景的对比度。您可能需要调整自动生成的坐标，或添加漏检的岩点。

## 配置文件参数说明

- `route_name`: 路线名称
- `difficulty`: 难度等级（例如V1-V17，5.8-5.15等）
- `description`: 路线描述
- `author`: 路线作者
- `date_created`: 创建日期
- `circle_color`: 圆圈颜色，RGB格式的数组，例如`[0, 255, 0]`代表绿色
- `text_color`: 文本颜色，RGB格式
- `arrow_color`: 箭头颜色，RGB格式
- `holds`: 岩点列表，每个岩点包含：
  - `x`: x坐标（横坐标）
  - `y`: y坐标（纵坐标）
  - `description`: 岩点描述（可选）
  - `area`: 岩点面积（仅自动检测时有，可选）

## 本地运行

如果您想在本地运行此工具：

1. 克隆此仓库
2. 安装依赖: `pip install opencv-python numpy`
3. 运行岩点检测: `python hold_detector.py --image <图片路径> --output <输出JSON路径> --debug <调试图像路径>`
4. 运行路线可视化: `python route_visualizer.py --image <图片路径> --config <配置文件路径>`

## 注意事项

- 图片应该是从距离墙面5米、与墙面平行的位置拍摄的
- 推荐使用高清图片以便更准确地标记岩点
- 坐标系以图片的左上角为原点
- 自动检测可能无法识别所有岩点，尤其是颜色与背景相似的岩点
